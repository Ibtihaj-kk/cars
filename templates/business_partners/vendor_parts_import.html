{% extends 'parts/base.html' %}
{% load static %}

{% block title %}Bulk Import Parts - {{ vendor_profile.business_partner.company_name }}{% endblock %}

{% block extra_css %}
<style>
    .import-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .import-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 30px;
        margin-bottom: 20px;
    }
    
    .import-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
    }
    
    .import-header h1 {
        color: #2c3e50;
        margin-bottom: 10px;
    }
    
    .import-header p {
        color: #7f8c8d;
        font-size: 16px;
    }
    
    .form-group {
        margin-bottom: 25px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2c3e50;
    }
    
    .form-control {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #3498db;
    }
    
    .checkbox-group {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .checkbox-group input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.2);
    }
    
    .checkbox-group label {
        margin-bottom: 0;
        font-weight: normal;
    }
    
    .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-block;
        text-align: center;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #2980b9, #21618c);
        transform: translateY(-2px);
    }
    
    .btn-secondary {
        background: #95a5a6;
        color: white;
        margin-right: 15px;
    }
    
    .btn-secondary:hover {
        background: #7f8c8d;
    }
    
    .help-text {
        background: #f8f9fa;
        border-left: 4px solid #3498db;
        padding: 15px;
        margin: 20px 0;
        border-radius: 0 8px 8px 0;
    }
    
    .help-text h4 {
        color: #2c3e50;
        margin-bottom: 10px;
    }
    
    .help-text ul {
        margin: 10px 0;
        padding-left: 20px;
    }
    
    .help-text li {
        margin-bottom: 5px;
        color: #5a6c7d;
    }
    
    .sample-download {
        text-align: center;
        margin: 20px 0;
        padding: 20px;
        background: #e8f5e8;
        border-radius: 8px;
        border: 1px solid #d4edda;
    }
    
    .sample-download a {
        color: #28a745;
        text-decoration: none;
        font-weight: 600;
    }
    
    .sample-download a:hover {
        text-decoration: underline;
    }
    
    .button-group {
        text-align: center;
        margin-top: 30px;
    }
    
    .error-list {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }
    
    .error-list ul {
        margin: 0;
        padding-left: 20px;
    }
    
    .error-list li {
        color: #721c24;
        margin-bottom: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="import-container">
    <div class="import-card">
        <div class="import-header">
            <h1><i class="fas fa-upload"></i> Bulk Import Parts</h1>
            <p>Upload CSV or Excel files to import multiple parts at once</p>
        </div>
        
        {% if form.errors %}
        <div class="error-list">
            <h4>Please correct the following errors:</h4>
            <ul>
                {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                        <li>{{ field|title }}: {{ error }}</li>
                    {% endfor %}
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="{{ form.import_file.id_for_label }}">
                    <i class="fas fa-file"></i> Select Import File
                </label>
                {{ form.import_file }}
                <small class="form-text text-muted">
                    Supported formats: CSV, Excel (.xlsx, .xls). Maximum file size: 10MB
                </small>
            </div>
            
            <div class="form-group">
                <div class="checkbox-group">
                    {{ form.update_existing }}
                    <label for="{{ form.update_existing.id_for_label }}">
                        Update existing parts (if part number already exists)
                    </label>
                </div>
                
                <div class="checkbox-group">
                    {{ form.validate_only }}
                    <label for="{{ form.validate_only.id_for_label }}">
                        Validate only (don't import, just check for errors)
                    </label>
                </div>
            </div>
            
            <div class="button-group">
                <a href="{% url 'business_partners:vendor_parts_list' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Parts
                </a>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-upload"></i> Import Parts
                </button>
            </div>
        </form>
    </div>
    
    <div class="import-card">
        <div class="help-text">
            <h4><i class="fas fa-info-circle"></i> Import Guidelines</h4>
            <ul>
                <li><strong>Required Fields:</strong> Part Number, Name</li>
                <li><strong>Optional Fields:</strong> Description, Category, Brand, Price, Quantity, etc.</li>
                <li><strong>Boolean Fields:</strong> Use "Yes/No", "True/False", or "1/0" for Active/Featured</li>
                <li><strong>Numeric Fields:</strong> Use decimal format for prices (e.g., 99.99)</li>
                <li><strong>Categories/Brands:</strong> Must exist in the system (case-sensitive)</li>
                <li><strong>File Encoding:</strong> UTF-8 recommended for special characters</li>
            </ul>
        </div>
        
        <div class="sample-download">
            <p><i class="fas fa-download"></i> <strong>Need a template?</strong></p>
            <p>
                <a href="{% url 'business_partners:vendor_parts_export' %}">
                    Download a sample CSV/Excel template with your existing parts
                </a>
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.querySelector('input[type="file"]');
    const validateOnly = document.querySelector('input[name="validate_only"]');
    const submitBtn = document.querySelector('button[type="submit"]');
    
    // Update button text based on validate_only checkbox
    validateOnly.addEventListener('change', function() {
        if (this.checked) {
            submitBtn.innerHTML = '<i class="fas fa-check"></i> Validate File';
        } else {
            submitBtn.innerHTML = '<i class="fas fa-upload"></i> Import Parts';
        }
    });
    
    // File validation
    fileInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const maxSize = 10 * 1024 * 1024; // 10MB
            const allowedTypes = ['.csv', '.xlsx', '.xls'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (file.size > maxSize) {
                alert('File size must be less than 10MB');
                this.value = '';
                return;
            }
            
            if (!allowedTypes.includes(fileExtension)) {
                alert('Please select a CSV or Excel file');
                this.value = '';
                return;
            }
        }
    });
});
</script>
{% endblock %}